## 一致性算法

在了解一致性算法之前，需要考虑三个问题：

+ 如何又快又好又省的对大规模数据集进行存储和技术？
+ 如何让跨网络的机器之间协调一致的工作？
+ 如何应对网络的不可靠以及节点的失效？

第一个问题，假设单机存储量是50G，这个时候要存储100G的数据，就需要加大容量，每次当容量不足的时候，就一直添加，这种方法是被称为 **垂直扩展**，但是这样的话，成本就会越来越高，**当到达一定程度的时候，就会遇到一些瓶颈问题，比如硬件没有办法在做的更好，并且造价成本也非常的高。**

这个时候单机已经无法满足了，所以就需要使用更多的机器来分担这个成本，**但是这就涉及到机器之间的通信和一致性问题。**

假设三台机器，其中一台机器写入数据，那其他两台机器也要同时写入数据，**在单机上这个还好处理，因为只是两个进程，不会涉及到其他问题，只有写入成功和写入失败两个状态，但是机器之间不一样，它们依赖网络传输那就会有三个状态:写入成功，写入失败，信息丢失** **并且也没有办法分别出来消息是丢失了还是延迟了，所以只能追求最终一致性。**

#### 可用性

+ 可读写
+ 可读
+ 不可用

### 一致性

+ 立即一致性
+ 最终一致性

而一致性算法就能够解决之前提到过的问题，**所以能够组织机器使其状态为最终一致性并且允许局部失败的算法就是一致性算法。**

### 最终一致性实现

## Raft

Raft是一种为了管理复制日志的一致性算法，它提供了和Paxos算法相同的功能和性能，但是Raft的算法结构和Paxos的不一样，而且Raft算法更加容易理解和实现，为了提高可理解性，Raft将一致性算法分成了几个关键模块：

+ Leader选举(leader election)
+ 日志同步(log replication)
+ 安全性 (safety)
+ 成员变更(Membership changes):
+  Strong leader:

### raft状态机

+ folloer状态
+ candidate状态
+ leader状态

### 复制状态机

在复制状态机中，一组服务器上的状态机产生相同状态的副本，并且在一些机器宕掉的情况下也可以继续运行，复制状态机在分布式系统中用来解决容错问题。

一个典型的应用就是一个独立的复制状态机去管理leader选举和存储配置信息，并且能够在leader宕机的情况下存活下来。

复制状态机的经典实现方法是使用(replicated log)，如下图所示，每台服务器存储一个包含一些的指令日志，并且按照日志的顺序进行执行，每个日志按照相同的顺序包含相同的指令，所以每一个服务器都执行相同的指令序列，因为状态机都是确定的，每次执行都产生相同的状态和同样的序列。

![figure1](D:\CS-openCourse\2021MIT6.824Notes\paperNotes\figure1.JPG)

尽管有些服务器辉宕机，但是指令一旦被正确的复制，每一个服务器的状态机都按照日志顺序来处理它们，最后输出结果返回给客户端就可以了，所以服务器集群看来像一个高可靠的状态机。

### raft数据结构



### Paxos算法的问题

